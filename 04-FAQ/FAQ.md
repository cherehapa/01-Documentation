# ЧаВо

## Что такое quote->data->infoPerTourist->perTourist ...
Это стоимость полиса для одного туриста в расчёте. Если передан запрос на расчет страховки для нескольких туристов, то поле quote->data->price будет содержать суммарную стоимость расчета, а в quote->data->infoPerTourist->perTourist - стоимость страховки для конкретного туриста. Она может варьироваться в зависимости от возраста туриста - для пожилых туристов она дороже.
Например:
http://partner.tst.cherehapa.ru/v2/quote/1?dateStart=22.12.2014&dateEnd=22.12.2014&tourist%5B0%5D%5Bbirthday%5D=03.03.1987&tourist%5B1%5D%5Bbirthday%5D=03.03.1935&country%5B0%5D=italy&service%5Bmedicine%5D=100000&key=shee6Iel4S
Запрос делается для двух туристов, на момент поездки возраст первого 27 лет, возраст второго 68 лет. Стоимость полиса для первого туриста составляет 2,86 у.е., стоимость для второго туриста с учётом возраста 11,44 у.е.."

## Что такое quote->data->assistances ...
Ассистанс это сервисная компания, которая организует медицинское обслуживание туристу, если возникнет страховой случай. Страховые компании не занимаются этим сами. Например, есть ассистанс GVA и с ним работают АльфаСтрахование, ВТБ страхование и др.
В поле quote->data->assistances находятся контактные данные ассистансов, т.е. те телефоны, по которым должен звонить турист, если что-то случится. Ассистансы и телефоны могут различаться в зависимости от страны пребывания, поэтому вывод в quote->data->assistances разбит по странам. В это поле выводятся только те контактные данные, которые нужны туристу.
quote->data->assistances->[code]->phone - международный телефон
quote->data->assistances->[code]->localPhone - местный телефон, доступный только из соответствующей страны.

## Страховой полис обязательно должен содержать страховые продукты?
Должно ли быть упоминание названия продукта в печатной форме? Не обязательно. У некоторых страховых продукт можно определить по коду полиса, где-то различается текст или набор услуг в форме, у кого-то эта информация пропущена вовсе.

## Что происходит если в запросе на оформление полиса\расчет стоимости есть и страховые услуги и страховые продукты?
В запросе на расчет стоимости какие-то услуги должны быть, а вот код продукта не обязателен.
Если код продукта не указывать, т.е. отправить запрос вида /quote/?...условия..., то будут расчитаны все продукты, доступные в системе по условиям запроса,в ответ вернется массив с результатами по каждому из продуктов.
Если код продукта указать, сделав запрос вида /quote/39?...условия..., то будет расчитан только продукт, код которого указан в запросе и в ответ вернется результат только по выбранному продукту.
При создании полиса код(ы) продуктов обязательны - именно по указанным продуктам и будут выписаны полисы и если их нет, то вернется ошибка.
Условия страхования нужно указывать везде, но если делать расчет, то в итоговом ответе вернется объект request, код которого (quote->request->id) можно указать в запросе на создание полиса вместо условий страхования.
К примеру так: /policy?insuranceProduct=39&requestId=10580
Так же можно использовать requestId и при проведении повторных расчетов по указанным ранее условиям. Например:
http://partner.tst.cherehapa.ru/v2/quote/1?requestId=10580&key=shee6Iel4S
http://partner.tst.cherehapa.ru/v2/quote/39?requestId=10580&key=shee6Iel4S

## В документации в качестве ответов на запрос функции task приведены 2 возможных состояния, в первом случае task является объектом, во втором - массивом объектов. Во втором ответе всегда возвращается массив объектов? И что за информация содержится в этих объектах?
Tasks - это технические объекты, описывающие различные задачи, выполняемые при формировании полиса. В простейшем случае, если оплата безналом, один продукт, один турист - будет только одна задача. Дополнительные задачи могут возникать если по запросу потребуется сформировать несколько полисов (под каждый полис будет создано по задаче): в заказе несколько продуктов, или в заказе больше туристов, чем может быть в одном полисе. Если задача одна - будет один объект. Если задач получилось несколько - будет массив.
В свойствах есть task->completeness, по которому можно отслеживать прогресс в выполнении задач. Также в свойствах можно посмотреть, возникли ли какие-то ошибки при формировании задачи. В целом, если задач несколько, то можно обращать внимание только на ту, id которой совпадает с id задачи в запросе.

## Будет ли полная документация с описанием всех объектов и их свойств?
Да, полное описание будет, но подготовить сможем только после запуска. Если требуется что-то подробное - может быть получено по запросу через email.

## Страховка может быть на одну страну, несколько стран или группу стран?
Страховка может быть как на одну страну, так и на несколько стран. Ограничения по количеству стран нет. Указывать группу стран не обязательно - это сделано для удобства. Если пользователь хочет купить страховку во все страны Южной Америки, скажем, то в запросе можно указать код соответствующей группы стран, а не перечислять их отдельно.

## В чем разница между страховым продуктом и страховой услугой (для чего нужны страховые продукты и как они работают)?
Страховой продукт (программа страхования) - это товар, который продает страховая компания. Страховые продукты отличаются наполнением - страховыми услугами (или рисками, в терминологии страховых компаний), которые в них включены. Т.е. есть, скажем, продукт А, который включает чуть меньше услуг и потому чуть дешевле, чем продукт Б, в котором услуг больше.

Вот, к примеру, описание продуктов (программ) Росгосстраха:

![Описание продуктов Росгосстраха](../img/rgs.png)

Фактически, наш калькулятор расчитывает все продукты всех страховых компаний и выбирает наиболее подходящий под условия, обозначенные в запросе.

Чем выше параметр matchRating (от 0 до 1) у продукта в результатах расчета, тем больше он подходит пользователю.
http://partner.tst.cherehapa.ru/v2/quote?dateStart=22.12.2014&dateEnd=22.12.2014&tourist%5B0%5D%5Bbirthday%5D=01.01.2014&country%5B0%5D=italy&service%5Bmedicine%5D=30000&key=shee6Iel4S

Можно сказать, что в старой версии API мы выдавали стоимость только одного, наиболее подходящего продукта по каждой страховой компании. А сейчас мы выдаем стоимость всех продуктов и помечаем, какой из них больше подходит.

## Можно получить перечень страховых компаний, но совсем непонятно - где и как его использовать?
Список страховых компаний используется для организации интерфейса выписки страховых полисов. В своем интерфейсе мы используем список страховых компаний для того, чтобы показать не просто названия продуктов, а еще и названия/логотипы страховых компаний, которые продают каждый из продуктов.
В целом, кроме как для организации интерфейса, список страховых компаний нигде не нужен.

## Есть ли возможность редактировать полис?
Возможность редактировать страховой полис заложена в API, но эта функция пока не отработана с нашей стороны. В новой версии API мы все полисы выписываем через API страховых компаний, а функцию обновления данных в полисе поддерживают далеко не все. Мы, со своей стороны, пока решаем этот вопрос - скорее всего для таких компаний мы будем реализовывать функцию обновления через отмену старого полиса и выписку нового, но этот функционал пока не надежен, поэтому не рекомендую его использовать. Когда мы отработаем этот процесс информация будет доступна.
С точки зрения API процесс обновления данных полиса будет аналогичным процессу обновления данных запроса, т.е. PUT /policy/<id> с параметрами.

## Как аннулировать полис?
Аннуляцию пока не описана в документации - мы ее только закончили.
DELETE /policy/<id>.
Метод будет описан немного позднее.

## Как узнать валюту страховой суммы (которая будет выплачена при наступлении страхового случая)?
Валюта страховой суммы задается в запросе на ваше усмотрение. Может быть EUR или USD.

http://partner.tst.cherehapa.ru/v2/quote?dateStart=22.12.2014&dateEnd=22.12.2014&tourist%5B0%5D%5Bbirthday%5D=01.01.2014&country%5B0%5D=italy&service%5Bmedicine%5D=30000&currency=EUR&key=shee6Iel4S

http://partner.tst.cherehapa.ru/v2/quote?dateStart=22.12.2014&dateEnd=22.12.2014&tourist%5B0%5D%5Bbirthday%5D=01.01.2014&country%5B0%5D=italy&service%5Bmedicine%5D=30000&currency=USD&key=shee6Iel4S

По-умолчанию - USD. Однако, некоторые продукты расчитываются только в одной валюте (см. Allianz, продукт 73 - считается только в USD), поэтому в выдаче функции quote у каждого продукта присутствует параметр currency, в котором указывается валюта, в которой продукт был расчитан в итоге. Например, в резульатах расчета продукта 73 валюта всегда будет стоять USD, вне зависимости от того, что было указано в запросе.
http://joxi.ru/KAg7dZBCb8LOAl

## На сколько человек максимально можно выписать один полис?
Максимальное количество человек зависит от страховой компании и полиса. В целом, нашим партнерам это знать не обязательно - у нас нет ограничения на количество туристов со стороны API - мы автоматически разобьем туристов по полисам и сформируем нужное количество полисов сами. Однако, заказы с большим количеством туристов будут формироваться долго, поэтому я бы рекомендовал сделать ограничение по количеству 10 туристов.

## Несколько вопросов по поводу самой покупки полиса. В методе по созданию полиса есть необязательные параметры - данные карточки покупателя. Если они передаются, и там все верно, то деньги списываются непосредственно с карты. А если они заведомо ложные или недействительные? Или же для снятия денег необходимо вводить код, полученный по СМС? Если я правильно понимаю, то наилучший вариант - это когда мы принимаем оплату от пользователей у себя, а потом вы выставляете нам счет для оплаты сгенерированных страховок? Или у вас есть некий свой сервис по приему платежей, используя который, мы связываем непосредственно путешественника и вас?

Если данные заведомо неправильные, то процесс формирования полиса остановится на этапе оплаты с фатальной ошибкой, поясняющей, что не так во веденных данных (неверный код карты, cvc, недостаточно средств и т.п.). Это можно будет узнать из полей ответа. Если нужно будет вводить код из СМС, то в полях объекта transaction будет URL, на который необходимо перенаправить пользователя для завершения оплаты. До завершения документации по процессу оплаты еще достаточно далеко, поэтому, если есть возможность принимать оплату с вашей стороны, то рекомендуем так и делать. Для этого указывайте paymentSystem=8 в параметрах запроса на создание полиса - это безналичная оплата с нашей стороны. Т.е. используя ее вы должны списать деньги с клиента сами, а мы ежемесячно будем выставлять счет за выписанные полисы.
